- name: Jenkins
  hosts: 127.0.0.1
  sudo: yes
  roles:
   - {
    role: flyapen.jenkins,
    plugins: [
      'greenballs',
      'simple-theme-plugin',
      'robot',
      'xvfb',
      'workflow-aggregator', # workflow
      'workflow-api', # workflow dep
      'workflow-basic-steps', # workflow dep
      'workflow-cps', # workflow dep
      'workflow-cps-global-lib', # workflow dep
      'workflow-durable-task-step', # workflow dep
      'workflow-job', # workflow dep
      'workflow-scm-step', # workflow dep
      'workflow-step-api', # workflow dep
      'workflow-support', # workflow dep
    ],
  }

  tasks:

    # Set Hostname
    # - hostname: name=jenkins.mycompany.com

    # Nginx
    - name: Install Nginx
      apt: name=nginx state=installed
      notify: Restart nginx

    # Nginx default
    - name: remove nginx default configuration
      file: path=/etc/nginx/sites-enabled/default state=absent
      notify: Restart nginx

    - name: jenkins nginx sites-available
      template: src=etc/nginx.txt dest=/etc/nginx/sites-available/jenkins owner=root group=root mode=0755
    - name: jenkins nginx sites-enabled
      file: path=/etc/nginx/sites-enabled/jenkins state=link src=/etc/nginx/sites-available/jenkins
      notify: Restart nginx

  handlers:

    - name: Restart ssh
      action: service name=ssh state=restarted

    - name: Restart nginx
      action: service name=nginx state=reloaded

    - name: Restart Jenkins
      action: service name=jenkins state=restarted
